<form #referralDataForm="ngForm" (ngSubmit)="onSubmit()" class="ct09-form"
  fxLayout="column"
  fxLayoutAlign="center center"
>
  <p class="mat-title">Astreintes et permanences</p>
  <mat-divider></mat-divider>

  <div class="field type" fxFlex="100">
    <mat-radio-group
      fxLayout="row wrap"
      fxLayout.lt-md="column"
      fxLayoutGap="30px"
      fxLayoutAlign="center"
      [(ngModel)]="data.type"
      name="type"
      required
    >
      <mat-radio-button value="Astreintes">Astreintes</mat-radio-button>
      <mat-radio-button value="Permanences">Permanences</mat-radio-button>
    </mat-radio-group>
  </div>

  <mat-divider></mat-divider>

  <div
    fxLayout="row wrap"
    fxLayout.lt-md="column"
    fxLayoutGap="30px"
    fxLayoutAlign="center"
    fxFlexFill
  >
    <mat-form-field class="field" fxFlex="40" fxFlex.lt-md="100">
      <input matInput
        [(ngModel)]="data.application"
        [matDatepicker]="applicationDatePicker"
        name="application"
        placeholder="Date d'entrée en vigueur"
        required
      >
      <mat-datepicker-toggle matSuffix [for]="applicationDatePicker"></mat-datepicker-toggle>
      <mat-datepicker #applicationDatePicker></mat-datepicker>
    </mat-form-field>

    <div class="field artt" fxFlex="70" fxLayoutAlign="center center">
      <mat-checkbox [(ngModel)]="data.artt" name="artt">La mise en place des astreintes ou permanences modifie le protocole ARTT</mat-checkbox>
    </div>

    <div class="field rules" fxFlex="70" fxLayoutAlign="center center">
      <mat-checkbox [(ngModel)]="data.rules" name="rules">La mise en place des astreintes ou permanences modifie le règlement intérieur</mat-checkbox>
    </div>
  </div>

  <div *ngIf="data.type === 'Astreintes'"
    fxLayout="row wrap"
    fxLayout.lt-md="column"
    fxLayoutGap="30px"
    fxLayoutAlign="center"
    fxFlexFill
  >
    <mat-form-field class="field" fxFlex="70" fxFlex.lt-md="80">
      <textarea
        fxFlexFill
        [(ngModel)]="data.watchType"
        matInput
        cdkTextareaAutosize
        name="watchType"
        id="watch-type"
        placeholder="Types d'astreintes (décision, exploitation ou sécurité)"
        required
      ></textarea>
    </mat-form-field>
  </div>

  <div
    fxLayout="row wrap"
    fxLayout.lt-md="column"
    fxLayoutGap="30px"
    fxLayoutAlign="center"
    fxFlexFill
  >
    <mat-form-field class="field" fxFlex="70" fxFlex.lt-md="80">
      <textarea
        fxFlexFill
        [(ngModel)]="data.missions"
        matInput
        cdkTextareaAutosize
        name="missions"
        id="missions"
        placeholder="Liste des missions"
        required
      ></textarea>
    </mat-form-field>

    <mat-form-field
      class="field service"
      fxFlex.lt-md="100"
      fxFlex="50"
    >
      <input matInput
        [(ngModel)]="data.service"
        name="service"
        placeholder="Services concernés"
        required
      >
    </mat-form-field>

    <mat-form-field class="field" fxFlex="70" fxFlex.lt-md="80">
      <textarea
        fxFlexFill
        [(ngModel)]="data.jobs"
        matInput
        cdkTextareaAutosize
        name="jobs"
        id="jobs"
        placeholder="Emplois et grades concernés"
        required
      ></textarea>
    </mat-form-field>

    <div class="field temporaries" fxFlex="70" fxLayoutAlign="center center">
      <mat-checkbox [(ngModel)]="data.temporaries" name="temporaries">Agents contractuels concernés</mat-checkbox>
    </div>

    <mat-form-field class="field" fxFlex="70" fxFlex.lt-md="80">
      <textarea
        fxFlexFill
        [(ngModel)]="data.hours"
        matInput
        cdkTextareaAutosize
        name="hours"
        id="hours"
        placeholder="Roulements et horaires"
        required
      ></textarea>
    </mat-form-field>

    <mat-form-field class="field delay" fxFlex.lt-md="100" fxFlex="30">
      <input matInput type="number" min="1" max="1000"
        [(ngModel)]="data.delay"
        name="delay"
        placeholder="Délai de prévenance en cas de modification du planning"
        required
      >
      <span matSuffix>jours</span>
    </mat-form-field>

    <mat-form-field class="field" fxFlex="70" fxFlex.lt-md="80">
      <textarea
        fxFlexFill
        [(ngModel)]="data.means"
        matInput
        cdkTextareaAutosize
        name="means"
        id="means"
        placeholder="Moyens mis à disposition (ex: téléphone, voiture, ...)"
        required
      ></textarea>
    </mat-form-field>

    <div class="field payment" fxFlex="100">
      <mat-radio-group
        fxLayout="row wrap"
        fxLayout.lt-md="column"
        fxLayoutGap="30px"
        fxLayoutAlign="center"
        [(ngModel)]="data.payment"
        name="payment"
        required
      >
        <mat-radio-button value="Paiement des {{ data.type|lowercase }}">Paiement des {{ data.type|lowercase }}</mat-radio-button>
        <mat-radio-button value="Compensation des {{ data.type|lowercase }}">Compensation des {{ data.type|lowercase }}</mat-radio-button>
      </mat-radio-group>
    </div>

    <div *ngIf="data.type === 'Astreintes'" class="field interventions" fxFlex="100">
      <mat-radio-group
        fxLayout="row wrap"
        fxLayout.lt-md="column"
        fxLayoutGap="30px"
        fxLayoutAlign="center"
        [(ngModel)]="data.interventions"
        name="interventions"
        required
      >
        <mat-radio-button value="Paiement des interventions">Paiement des interventions</mat-radio-button>
        <mat-radio-button value="Compensation des interventions">Compensation des interventions</mat-radio-button>
      </mat-radio-group>
    </div>
  </div>

  <div class="button">
    <button type="submit" mat-raised-button color="accent" [disabled]="referralDataForm.invalid">Suivant</button>
  </div>
</form>

